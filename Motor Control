// Functions for motor control
#include "pico/stdlib.h"
#include "hardware/pwm.h"

#define DIR_LEFT 22
#define STEP_LEFT 21
#define DIR_RIGHT 20
#define STEP_RIGHT 19
#define WRAP_LEVEL 65500
#define STEP_LEVEL 32750

void init_motor_control() {
    gpio_init(DIR_LEFT);
    gpio_set_dir(DIR_LEFT, GPIO_OUT);

    gpio_init(DIR_RIGHT);
    gpio_set_dir(DIR_RIGHT, GPIO_OUT);

    gpio_set_function(STEP_LEFT, GPIO_FUNC_PWM);
    gpio_set_function(STEP_RIGHT, GPIO_FUNC_PWM);

    uint slice_num_LEFT = pwm_gpio_to_slice_num(STEP_LEFT);
    uint slice_num_RIGHT = pwm_gpio_to_slice_num(STEP_RIGHT);

    pwm_set_wrap(slice_num_LEFT, WRAP_LEVEL);
    pwm_set_wrap(slice_num_RIGHT, WRAP_LEVEL);

    pwm_set_chan_level(slice_num_LEFT, PWM_CHAN_B, STEP_LEVEL);
    pwm_set_chan_level(slice_num_RIGHT, PWM_CHAN_B, STEP_LEVEL);

    pwm_set_enabled(slice_num_LEFT, false);
    pwm_set_enabled(slice_num_RIGHT, false);
}

void move_forward() {
    uint slice_num_LEFT = pwm_gpio_to_slice_num(STEP_LEFT);
    uint slice_num_RIGHT = pwm_gpio_to_slice_num(STEP_RIGHT);

    gpio_put(DIR_LEFT, 1);  // Left motor forward
    gpio_put(DIR_RIGHT, 1); // Right motor forward

    pwm_set_enabled(slice_num_LEFT, true);
    pwm_set_enabled(slice_num_RIGHT, true);
}

void turn_left() {
    uint slice_num_LEFT = pwm_gpio_to_slice_num(STEP_LEFT);
    uint slice_num_RIGHT = pwm_gpio_to_slice_num(STEP_RIGHT);

    gpio_put(DIR_LEFT, 1);  // Left motor forward
    gpio_put(DIR_RIGHT, 0); // Right motor backward

    pwm_set_enabled(slice_num_LEFT, true);
    pwm_set_enabled(slice_num_RIGHT, true);
}

void turn_right() {
    uint slice_num_LEFT = pwm_gpio_to_slice_num(STEP_LEFT);
    uint slice_num_RIGHT = pwm_gpio_to_slice_num(STEP_RIGHT);

    gpio_put(DIR_LEFT, 0);  // Left motor backward
    gpio_put(DIR_RIGHT, 1); // Right motor forward

    pwm_set_enabled(slice_num_LEFT, true);
    pwm_set_enabled(slice_num_RIGHT, true);
}

void stop_motors() {
    uint slice_num_LEFT = pwm_gpio_to_slice_num(STEP_LEFT);
    uint slice_num_RIGHT = pwm_gpio_to_slice_num(STEP_RIGHT);

    pwm_set_enabled(slice_num_LEFT, false);
    pwm_set_enabled(slice_num_RIGHT, false);
}

int main(void) {
    stdio_init_all();
    init_motor_control();

    while (true) {
        }
    }

